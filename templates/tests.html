{% extends "base.html" %}

{% block content %}
<div class="center-contents">
    <div class="tag-picker-box">
        <div class="tag-display">
            <!-- simple tag structure as follows, generated by js tho -->
            <!-- <div class="tag">test-tag</div> -->
        </div>
        <input type="text" class="tag-input" onkeyup="updateTags(this)" placeholder="Enter tags (separated by commas); click a tag to delete it.">
        <input type="text" class="tags-dummy-input" style="display: none;" value="">
    </div>
</div>

<script>
    let tags = [];
    const maxTagsAmount = 3;

    function updateTags(inputElement){
        let currentText = inputElement.value;

        // checking for tag splitting characters, probably only comma in the end tho
        if (currentText.endsWith(",") || currentText.endsWith(" ")){
            const currentTextLength = currentText.length;
            // trimming entered text to everything but the separating char
            currentText = currentText.slice(0, currentTextLength - 1);

            inputElement.value = "";
            
            if (currentText != "" && !currentText.includes(",")){
                // check if entered tag would be a duplicate (we dont want those)
                if (tags.includes(currentText) || tags.length >= maxTagsAmount){
                    return;
                }

                tags.push(currentText);

                // create the new tag html element accordingly
                const new_tag = document.createElement("div");
                new_tag.classList.add("tag");
                new_tag.classList.add("tag-" + currentText);
                new_tag.innerHTML = currentText;
                document.querySelector(".tag-display").appendChild(new_tag);

                // set onmousedown event to call removal function below
                new_tag.onclick = function (){
                    deleteTag(new_tag);
                }

                // set dummy input value to joined array with original separator as one again
                let stringTags = tags.join(",");
                document.querySelector(".tags-dummy-input").value = stringTags;

                return 200;
            }
        }

        return;
    }

    function deleteTag(clickedTag){
        // get index in tags array of to-delete tag and then splice it
        const tagIndex = tags.indexOf(clickedTag.innerHTML);
        tags.splice(tagIndex, 1);

        // remove visible .tag element from above
        clickedTag.remove();

        return;
    }
</script>

{% endblock %}